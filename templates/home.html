{% extends 'base.html' %}

{% block content %}
<div style="display:flex; gap:20px;">

    <!-- SIDEBAR -->
    <aside style="width:220px;">
        {% include 'partials/category_sidebar.html' %}
    </aside>

    <!-- MAIN CONTENT -->
    <main style="flex:1;">

        <!-- SEARCH BAR -->
        <form method="get" style="margin-bottom:20px; display:flex; gap:10px;">
            <input
                type="text"
                name="q"
                placeholder="Search products..."
                value="{{ query|default:'' }}"
                style="flex:1; padding:5px;"
            >

            <select name="category" style="padding:5px;">
                <option value="">All Categories</option>
                {% for cat in sidebar_categories %}
                    <option value="{{ cat.id }}"
                        {% if selected_category == cat.id|stringformat:"s" %}selected{% endif %}>
                        {{ cat.name }}
                    </option>
                {% endfor %}
            </select>

            <button type="submit" style="padding:5px 10px;">Search</button>
        </form>

        <!-- PRODUCTS GRID -->
        {% if products %}
            <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px,1fr)); gap:20px;">
                {% for product in products %}
                    <div class="product" style="border:1px solid #ddd; padding:10px; border-radius:5px;">
                        <img src="{{ product.image.url }}" alt="{{ product.name }}" style="width:100%; height:200px; object-fit:cover;">
                        <h3 style="margin:10px 0 5px;">{{ product.name }}</h3>
                        <p style="margin:0 0 5px;"><strong>${{ product.price }}</strong></p>
                        <p style="font-size:14px; color:#555;">{{ product.description|truncatechars:50 }}</p>
                        <a href="{% url 'product_detail' product.slug %}" 
                           style="display:inline-block; margin-top:10px; text-decoration:none; color:white; background:#333; padding:5px 10px; border-radius:3px;">
                           View
                        </a>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No products found.</p>
        {% endif %}

    </main>
</div>
{% endblock %}
