{% extends 'base.html' %}

{% block content %}
<div style="display:flex; gap:20px;">

    <!-- SIDEBAR -->
    <aside style="width:250px;">

        <!-- CATEGORIES -->
        {% include 'partials/category_sidebar.html' %}

        <!-- NEW ARRIVALS -->
        {% if latest_products %}
        <div style="margin-top:25px;">
            <h3 style="border-bottom:2px solid #333; padding-bottom:5px;">
                New Arrivals
            </h3>

            <div style="display:flex; flex-direction:column; gap:10px; margin-top:10px;">
                {% for lp in latest_products %}
                <a href="{% url 'product_detail' lp.slug %}"
                   style="display:flex; gap:10px; align-items:center; text-decoration:none; color:#333;">

                    <img src="{{ lp.image.url }}"
                         style="width:55px; height:55px; object-fit:cover; border-radius:5px;">

                    <div>
                        <strong style="display:block;">{{ lp.name }}</strong>
                        <span style="font-size:13px;">${{ lp.price }}</span>
                    </div>

                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

    </aside>

    <!-- MAIN CONTENT -->
    <main style="flex:1;">

        <!-- SEARCH BAR -->
        <form method="get" style="margin-bottom:20px; display:flex; gap:10px;">
            <input
                type="text"
                name="q"
                placeholder="Search products..."
                value="{{ query|default:'' }}"
                style="flex:1; padding:8px;"
            >

            <select name="category" style="padding:8px;">
                <option value="">All Categories</option>
                {% for cat in sidebar_categories %}
                    <option value="{{ cat.id }}"
                        {% if selected_category == cat.id|stringformat:"s" %}selected{% endif %}>
                        {{ cat.name }}
                    </option>
                {% endfor %}
            </select>

            <button type="submit" style="padding:8px 14px;">
                Search
            </button>
        </form>

        <!-- PRODUCTS GRID -->
        {% if products %}
        <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px,1fr)); gap:20px;">
            {% for product in products %}
            <div style="border:1px solid #ddd; padding:10px; border-radius:6px;">
                <img src="{{ product.image.url }}"
                     alt="{{ product.name }}"
                     style="width:100%; height:200px; object-fit:cover; border-radius:5px;">

                <h3 style="margin:10px 0 5px;">
                    {{ product.name }}
                </h3>

                <p style="margin:0 0 5px;">
                    <strong>${{ product.price }}</strong>
                </p>

                <p style="font-size:14px; color:#555;">
                    {{ product.description|truncatechars:50 }}
                </p>

                <a href="{% url 'product_detail' product.slug %}"
                   style="display:inline-block; margin-top:10px; text-decoration:none;
                          color:white; background:#333; padding:6px 12px; border-radius:4px;">
                    View
                </a>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>No products found.</p>
        {% endif %}

    </main>
</div>
{% endblock %}
